{% extends 'base.html' %}

{% block title %}Financial Goals - WealthifyMe{% endblock %}

{% block content %}
<div class="container" style="margin-top: 2rem;">
    <div class="section-header">
        <h1 class="section-title">Financial Goals</h1>
        <a href="{{ url_for('goals_bp.add_goal') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Goal
        </a>
    </div>
    
    <!-- Active Goals -->
    <section class="section">
        <div class="section-header">
            <h2 class="section-title">Active Goals</h2>
        </div>
        
        {% if active_goals|length > 0 %}
            <div class="goals-grid">
                {% for goal in active_goals %}
                    {% set progress = goal[8]|round %}
                    {% set days_left = goal[7] %}
                    
                    <div class="goal-card card animate-fadeIn" style="animation-delay: {{ loop.index0 * 0.1 }}s;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <h3 class="card-title">{{ goal[1] }}</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="{{ url_for('goals_bp.update_goal', goal_id=goal[0]) }}" class="btn btn-sm btn-outline">
                                    <i class="fas fa-coins"></i>
                                </a>
                                <a href="{{ url_for('goals_bp.edit_goal', goal_id=goal[0]) }}" class="btn btn-sm btn-outline">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form method="POST" action="{{ url_for('goals_bp.delete_goal', goal_id=goal[0]) }}" style="display: inline;">
                                    <button type="submit" class="btn btn-sm btn-outline" style="color: var(--error-500);" onclick="return confirm('Are you sure you want to delete this goal?');">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        {% if goal[2] %}
                            <p style="color: var(--neutral-600); margin: 0.5rem 0; font-size: 0.875rem;">
                                {{ goal[2] }}
                            </p>
                        {% endif %}
                        
                        <div style="margin: 1rem 0;">
                            <div class="progress">
                                <div class="progress-bar" style="width: {{ progress }}%; background-color: var(--secondary-500);"></div>
                            </div>
                            <div class="progress-info">
                                <span>${{ goal[4]|round(2) }} of ${{ goal[3]|round(2) }}</span>
                                <span>{{ progress }}%</span>
                            </div>
                        </div>
                        
                        <div style="color: var(--neutral-600); font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Target Date:</span>
                                <span>{{ goal[5].strftime('%b %d, %Y') }}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Days Left:</span>
                                <span>{{ days_left }}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Remaining:</span>
                                <span>${{ (goal[3] - goal[4])|round(2) }}</span>
                            </div>
                        </div>
                        
                        <div class="goal-progress" style="width: {{ progress }}%;"></div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="card" style="text-align: center; padding: 2rem;">
                <p style="color: var(--neutral-600); margin-bottom: 1rem;">You don't have any active goals.</p>
                <a href="{{ url_for('goals_bp.add_goal') }}" class="btn btn-primary">Create Your First Goal</a>
            </div>
        {% endif %}
    </section>
    
    <!-- Completed Goals -->
    {% if completed_goals|length > 0 %}
        <section class="section">
            <div class="section-header">
                <h2 class="section-title">Completed Goals</h2>
            </div>
            
            <div class="goals-grid">
                {% for goal in completed_goals %}
                    <div class="goal-card card animate-fadeIn" style="animation-delay: {{ loop.index0 * 0.1 }}s; border-color: var(--success-400); border-width: 2px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <h3 class="card-title">{{ goal[1] }}</h3>
                            <span class="category-pill" style="background-color: var(--success-500); color: white;">
                                <i class="fas fa-check-circle" style="margin-right: 0.25rem;"></i> Completed
                            </span>
                        </div>
                        
                        {% if goal[2] %}
                            <p style="color: var(--neutral-600); margin: 0.5rem 0; font-size: 0.875rem;">
                                {{ goal[2] }}
                            </p>
                        {% endif %}
                        
                        <div style="margin: 1rem 0;">
                            <div class="progress">
                                <div class="progress-bar" style="width: 100%; background-color: var(--success-500);"></div>
                            </div>
                            <div class="progress-info">
                                <span>${{ goal[4]|round(2) }} of ${{ goal[3]|round(2) }}</span>
                                <span>100%</span>
                            </div>
                        </div>
                        
                        <div style="color: var(--neutral-600); font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Target Date:</span>
                                <span>{{ goal[5].strftime('%b %d, %Y') }}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Completed On:</span>
                                <span>{{ goal[6].strftime('%b %d, %Y') }}</span>
                            </div>
                        </div>
                        
                        <div class="goal-progress" style="width: 100%; background-color: var(--success-500);"></div>
                    </div>
                {% endfor %}
            </div>
        </section>
    {% endif %}
    
    <!-- Expired Goals -->
    {% if expired_goals|length > 0 %}
        <section class="section">
            <div class="section-header">
                <h2 class="section-title">Expired Goals</h2>
            </div>
            
            <div class="goals-grid">
                {% for goal in expired_goals %}
                    {% set progress = goal[8]|round %}
                    
                    <div class="goal-card card animate-fadeIn" style="animation-delay: {{ loop.index0 * 0.1 }}s; border-color: var(--error-400); border-width: 2px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <h3 class="card-title">{{ goal[1] }}</h3>
                            <span class="category-pill" style="background-color: var(--error-500); color: white;">
                                <i class="fas fa-exclamation-circle" style="margin-right: 0.25rem;"></i> Expired
                            </span>
                        </div>
                        
                        {% if goal[2] %}
                            <p style="color: var(--neutral-600); margin: 0.5rem 0; font-size: 0.875rem;">
                                {{ goal[2] }}
                            </p>
                        {% endif %}
                        
                        <div style="margin: 1rem 0;">
                            <div class="progress">
                                <div class="progress-bar" style="width: {{ progress }}%; background-color: var(--error-400);"></div>
                            </div>
                            <div class="progress-info">
                                <span>${{ goal[4]|round(2) }} of ${{ goal[3]|round(2) }}</span>
                                <span>{{ progress }}%</span>
                            </div>
                        </div>
                        
                        <div style="color: var(--neutral-600); font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Target Date:</span>
                                <span>{{ goal[5].strftime('%b %d, %Y') }}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Days Overdue:</span>
                                <span>{{ abs(goal[7]) }}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Shortfall:</span>
                                <span>${{ (goal[3] - goal[4])|round(2) }}</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 1rem; display: flex; justify-content: space-between;">
                            <a href="{{ url_for('goals_bp.edit_goal', goal_id=goal[0]) }}" class="btn btn-sm btn-outline">
                                Extend Deadline
                            </a>
                            <form method="POST" action="{{ url_for('goals_bp.delete_goal', goal_id=goal[0]) }}" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-outline" style="color: var(--error-500);" onclick="return confirm('Are you sure you want to delete this goal?');">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </form>
                        </div>
                        
                        <div class="goal-progress" style="width: {{ progress }}%; background-color: var(--error-400);"></div>
                    </div>
                {% endfor %}
            </div>
        </section>
    {% endif %}
</div>
{% endblock %}